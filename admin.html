<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HearAStory Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1 { color: #333; }

    .story {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin: 10px 0;
    }
    .story h3 {
      margin: 0;
    }
    .story p {
      margin: 5px 0;
    }
    .delete-btn {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Admin Panel â€“ Manage Stories</h1>

  <label for="type">Story Type:</label>
  <select id="type">
    <option value="adventure">Adventure</option>
    <option value="funny">Funny</option>
    <option value="mystery">Mystery</option>
    <option value="fantasy">Fantasy</option>
    <option value="horror">Horror</option>
    <option value="motivational">Motivational</option>
    <option value="moral">Moral</option>
  </select>

  <label for="language">Language:</label>
  <select id="language">
    <option value="en">English</option>
    <option value="hi">Hindi</option>
    <option value="es">Spanish</option>
    <option value="fr">French</option>
    <option value="de">German</option>
    <option value="ar">Arabic</option>
    <option value="ru">Russian</option>
    <option value="zh">Chinese</option>
  </select>

  <button onclick="fetchStories()">Load Stories</button>

  <div id="storiesContainer"></div>

  <script>
    const API_BASE = "https://hear-a-story.onrender.com/api/stories";

    async function fetchStories() {
      const type = document.getElementById("type").value;
      const language = document.getElementById("language").value;
      const container = document.getElementById("storiesContainer");
      container.innerHTML = "Loading...";

      try {
        const res = await fetch(`${API_BASE}?type=${type}&language=${language}`);
        if (!res.ok) throw new Error("No stories found.");
        const stories = await res.json();

        container.innerHTML = "";
        stories.forEach(story => {
          const div = document.createElement("div");
          div.className = "story";
          div.innerHTML = `
            <h3>${story.title}</h3>
            <p><strong>ID:</strong> ${story.id}</p>
            <p>${story.content}</p>
            <button class="delete-btn" onclick="deleteStory('${story.id}')">Delete</button>
          `;
          container.appendChild(div);
        });
      } catch (err) {
        container.innerHTML = `<p style="color:red;">${err.message}</p>`;
      }
    }

    async function deleteStory(id) {
      if (!confirm(`Are you sure you want to delete story ID "${id}"?`)) return;

      try {
        const res = await fetch(`${API_BASE}/${id}`, { method: "DELETE" });
        const result = await res.json();
        alert(result.message);
        fetchStories(); // reload list
      } catch (err) {
        alert("Error deleting story.");
      }
    }
  </script>
</body>
</html>
